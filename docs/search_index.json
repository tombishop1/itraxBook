[
<<<<<<< HEAD
["index.html", "Using Itrax Data in R Preface 0.1 Why did I write this book? 0.2 Prerequisites", " Using Itrax Data in R Thomas Bishop 2020-06-22 Preface 0.1 Why did I write this book? During the COVID-19 pandemic in 2020 it became necessary to formalise (or at least, organise) the support offered to students using the Itrax core scanner at The University of Manchester Geography Laboratories so they could be offered online. This led to an unexpectedly popular series of seminars. When these came to an end, we decided it would be useful to summarise our seminars into a reference guide that could be updated over time. This is that guide. 0.2 Prerequisites This guide assumes a basic knowledge of R and the tidyverse, including data types, assignments, and pipes. It also assumes a background knowledge of the core scanner and the nature of the data it produces. Some of the sections on data analysis assume some knowledge of compositional data analysis. "],
["intro.html", "Chapter 1 Data Structure 1.1 Metadata 1.2 XRF Data 1.3 Optical Images 1.4 Radiographic Images 1.5 Magnetic Susceptability", " Chapter 1 Data Structure The Itrax core scanner is a multi-sensor device, with seperate data outputs for different measurements and uses. They are described in the following sections. Note that your data may not contain all of these objects, depending on the exact scanner, configuration, or data repository you use. The folder structure may vary between operators, but typically there will be a folder for each scan section, and each will contain the data described in the following sections. Note that where radiographs and XRF data have been aquired using different step-sizes (measurement intervals), the operator will create seperate scan sections (folders) for the x-radiograph and XRF measurement. This is because a scan section can only have a single fixed step-size. For example, it is not uncommon for users to require an step-size of 200 micrometers for the x-radiograph, but only 1 millimeter for the XRF measurement. 1.1 Metadata Every scan section has a document.txt file that contains information about the parameters of the scan. For example, it contains the current and voltage settings used for the x-ray tube, the step size, and the start and stop positions of the scan. The file can be opened using any text editor, or can be easily parsed in R using itraxR::itrax_meta(). Sometimes this information is required to process other parts of the data, and as such it is an important part of the overall data package. 1.2 XRF Data The XRF data can be split into two groups — “raw” and “processed” data. The raw data is contained in a seperate folder called XRF data, and consists of a single file, beginning with L000000.spe and incrementing sequentially. This file can be read using a text editor and is tab-delimited. The first part is a header, containing metadata information. The second part is a table of all the channels of the detector and the corresponding count for each channel. Increasing channel numbers represent increasing energy, but some thought needs to be given to calibrating channels into an energy — this step is usually performed using specialist software. In addition, a file called sumspectra.spe is often included in the root directory; this is simply the sum of all the *.spe files in the XRF data directory, and is sometimes useful in processing the data. Processed data comes from the Q-Spec software (Cox Analytical Systems, Sweden) provided with the machine. Its function is to process the spectral data files (*.spe) into peak-areas for each element of interest by fitting a model to the data. The model needs some user input and intervention to optimise it, and the quality of the model can be assessed using a number of diagnostic parameters, the most important being the RMSE. The Q-Spec software can also perform some calibration of the data, although this is a less typical use-case. Often the operator will include a file that contains all of the settings used by Q-Spec to translate the raw data files into the peak area outfile file — this file will have the extension *.dfl and will often simply be called settings.dfl. It comes in the form of a table, with a single row for each measurement step, and a column for parameters including individual element peak areas in counts (n) or intensities (n/mA). The data files commonly have names like result.txt or Results.txt, but may have been subsequently renamed. 1.3 Optical Images The scanner collects good quality optical images that have consistent lighting and because they are line-scan images, they do not suffer from optical distortions. Medium resolution images are usually included in all scan section folders (typically optical.tif), and optional high-resolution images are often included by operators elsewhere. High resolution images are typically supplied as both 8-bit and 16-bit images, and are usually hundreds of megabytes in size. Although the brightness of the lighting in the scanner is adjustable, images sometimes need to be brightened and/or have the contrast adjusted. This can be performed in desktop publishing software (e.g. Adobe Photoshop, Corel Photo-Draw), but it is easiest to use the open-source scientific image analysis software imageJ (NIH, USA). By including an appropriate colour reference card in the scan the image can be calibrated, although it is often desirable to increase the contrast to elucidate features of the core. The photograph will of the entire length of the bed scanned, rather than cropped to the limits of an individual scan section. If multiple scan sections are placed on the bed and are scanned together, it will include all of the scanned sections. The image needs to be cropped using the metadata for the relevant scan section; this process is covered in later chapters. 1.4 Radiographic Images The scanner has an x-radiographic line array capable of producing good-quality x-radiographs of the cores. The scan data can be split into two parts — “raw” and “processed” data. The raw data (usually radiograph.raw) is a tab-delimited text file containing a matrix of greyscale values. Each column represents a single step (measurement interval), and each row represents a single pixel on the line array. The pixel spacing is around 20 microns. The processed image (radiograph.tif) has a lower resolution than the raw data. This is because the pixels must be square, and so the pixels are down-sampled to fit with the step-size of the scan. Thus, if the step-size was 200 micrometers, each pixel will be 200 x 200 micrometers, whereas the raw data will have rectangular pixels with dimensions of 20 x 200 micrometers. Like the optical image, the radiograph often requires contrast and brightness adjustments, and these are easiest to perform in imageJ. With the inclusion of a suitable density standard, some relative or, where “u-channels” are used, absolute density calibration can be performed using these data. 1.5 Magnetic Susceptability Some scanners include a Bartington MS2E surface sensor. "],
["importing.html", "Chapter 2 Importing Data 2.1 Metadata 2.2 XRF Data 2.3 Optical Images 2.4 Radiographic Images 2.5 Magnetic Susceptability", " Chapter 2 Importing Data All of the Itrax data is in either text-format or “tagged image format” (*.tif). Although this means it is easily read by the various import functions available in R, it still needs considerable cleaning and wrangling to get it to a point where it is useable for most analyses. There are three possible approaches to this task: Use existing functions published in the itraxR package available from github.com/tombishop1. These are at an early stage and functionality might be broken, but are largely convenience functions for wrangling and analysing Itrax data. Work in base R to wrangle the data. This is perfectly achievable, and much of the current itraxR functionality was written this way. Work in the tidyverse family of packages and style. For data wrangling tasks, this approach can result in simpler and more resiliant code. In this guide examples will be given mostly using the tidyverse, and reference will be made to the convenience functions in itraxR. 2.1 Metadata The scan data file document.txt can be parsed using itraxR::itrax_meta(). 2.2 XRF Data This is the data most commonly used in analysis and it can be quickly imported using itraxR::itrax_import(). If you’d like more control over the import process, a typical Tidyverse workflow would consist of reading the file (they are tab-delimited), removing variables that are not of interest, and correctly labelling data that should be NA. You may also wish to assign a coring depth information at this stage. 2.2.1 Processed Data This process is integrated, along with some other functionality, in itraxR::itrax_import(). 2.2.2 Joining XRF Data This process can be simplified using itraxR::itrax_join(). 2.2.3 Raw Data Sometimes it is useful to work with raw data rather than the calculated intensity data from the Q-Spec software. In this case, the raw data can be read directly from the individual files in the relevant directory. For individual measurements this is fairly trivial, although it must be considered that the data output is not calibrated to an energy and the data are in counts, not intensities. If the entire scan is read, some mechanism to iterate through the individual data files, adding them to a structured data object with relevant metadata (positions, for example) is required. 2.3 Optical Images In order to make the images useable for plotting beside other data, they need to be cropped to the scanned area and referenced to the position or a depth variable. Images in R are read in as a matrix with 3 dimensions (length, width, and the three colours). To begin with the start and end positions of the scan need to be established; this usually involves parsing the metadata file (e.g. itraxR::itrax_meta()[]), although in some circumstances they can be obtained from another data source (e.g. range(myData[,\"Position\"])). These then need to be mapped onto individual pixel values using the known size of a single pixel. Once this has been calculated, it is trvial to then subset the part of the image required. 2.4 Radiographic Images The workflow for manipulating the processed radiographic images (*.tif) is very similar to that for the optical images, the main difference being the matrix only has two dimensions (length and width) as the image is greyscale. However, if there is a desire to manipulate the raw data from the radiographic image, some further work is required because the “pixel” is not square, but rectangular. That is to say the length of the pixel differs from its width. On the core scanner a single pixel has a width across the core of 20 micrometers, but has a variable coverage along the core (usually between 50 and 200 micrometers). The processed image downscales the pixel width to match the pixel length in order to force square pixels, losing some resolution along the way. 2.5 Magnetic Susceptability "],
=======
["index.html", "Using Itrax Data in R Preface 0.1 Why did I write this book? 0.2 Prerequisites", " Using Itrax Data in R Thomas Bishop 2020-06-16 Preface 0.1 Why did I write this book? During the COVID-19 pandemic in 2020 it became necessary to formalise (or at least, organise) the support offered to students using the Itrax core scanner at The University of Manchester Geography Laboratories so they could be offered online. This led to an unexpectedly popular series of seminars. When these came to an end, we decided it would be useful to summarise our seminars into a reference guide that could be updated over time. This is that guide. 0.2 Prerequisites This guide assumes a basic knowledge of R and the tidyverse, including data types, assignments, and pipes. It also assumes a background knowledge of the core scanner and the nature of the data it produces. Some of the sections on data analysis assume some knowledge of compositional data analysis. "],
["intro.html", "Chapter 1 Data Structure 1.1 Metadata 1.2 XRF Data 1.3 Optical Images 1.4 Radiographic Images 1.5 Magnetic Susceptability", " Chapter 1 Data Structure The Itrax core scanner is a multi-sensor device, with seperate data outputs for different measurements and uses. They are described in the following sections. Note that your data may not contain all of these objects, depending on the exact scanner, configuration, or data repository you use. 1.1 Metadata 1.2 XRF Data 1.3 Optical Images 1.4 Radiographic Images 1.5 Magnetic Susceptability "],
["importing.html", "Chapter 2 Importing Data 2.1 Metadata 2.2 XRF Data 2.3 Optical Images 2.4 Radiographic Images 2.5 Magnetic Susceptability", " Chapter 2 Importing Data All of the Itrax data is in either text-format or “tagged image format” (*.tiff). Although this means it is easily read by the various import functions available in R, it still needs considerable cleaning and wrangling to get it to a point where it is useable. A number of convienience functions are provided in the package itraxR. 2.1 Metadata The scan data file document.txt can be read using itraxR::itrax_meta(). This is considerably easier than attempting to read it in a text editor, although this is possible. example(itrax_meta) ## ## itrx_m&gt; itrax_meta(system.file(&quot;extdata&quot;, &quot;document.txt&quot;, package = &quot;itraxR&quot;)) ## Parameter Value Unit ## 1 Sample name WV17-2-D1 str ## 2 Section name WV17-2-D1 str ## 3 Aquisition date 24/1/2017 dd/mm/yyyy ## 4 Operator name THB str ## 5 Tube Mo element ## 6 Start coordinate 27.3 mm ## 7 Stop coordinate 1064.3 mm ## 8 Step size 2000 microns ## 9 Optical Start 0.1 mm ## 10 Optical End 1102.9 mm ## 11 Optical step size 0.047 mm ## 12 Rad. voltage 60 kV ## 13 Rad. current 40 mA ## 14 Rad. exposure 450 ms ## 15 line camera signal level 571116 at 25 ms ## 16 XRF ON ON/OFF ## 17 XRF voltage 30 kV ## 18 XRF current 55 mA ## 19 XRF exp. time 10 seconds ## 20 Start temperature 26 \\xb0C ## 21 Stop temperature 27 \\xb0C ## 22 Start humidity 22 % ## 23 Stop humidity 21 % ## 24 Start vacuum -96.0 kPa ## 25 Stop vacuum -96.2 kPa 2.2 XRF Data 2.2.1 Processed Data This process is integrated, along with some other functionality, in itraxR::itrax_import(). 2.2.2 Joining XRF Data 2.2.3 Raw Data Sometimes it is useful to work with raw data rather than the calculated intensity data from the Q-Spec software. In this case, the raw data can be read directly from the individual files in the relevant directory. For individual measurements this is fairly trivial, although it must be considered that the data output is not calibrated to an energy and the data are in counts, not intensities. If the entire scan is read, some mechanism to iterate through the individual data files, adding them to a structured data object with relevant metadata (positions, for example) is required. 2.3 Optical Images In order to make the images useable for plotting beside other data, they need to be cropped to the scanned area and referenced to the position or a depth variable. Images in R are read in as a matrix with 3 dimensions (length, width, and the three colours). To begin with the start and end positions of the scan need to be established; this usually involves parsing the metadata file (e.g. itraxR::itrax_meta()[]), although in some circumstances they can be obtained from another data source (e.g. range(myData[,&quot;Position&quot;])). These then need to be mapped onto individual pixel values using the known size of a single pixel. Once this has been calculated, it is trvial to then subset the part of the image required. 2.4 Radiographic Images The workflow for manipulating the processed radiographic images (*.tiff) is very similar to that for the optical images, the main difference being the matrix only has two dimensions (length and width) as the image is greyscale. However, if there is a desire to manipulate the raw data from the radiographic image, some further work is required because the “pixel” is not square, but rectangular. That is to say the length of the pixel differs from its width. On the core scanner a single pixel has a width across the core of 20 micrometers, but has a variable coverage along the core (usually between 50 and 200 micrometers). The processed image downscales the pixel width to match the pixel length in order to force square pixels, losing some resolution along the way. 2.5 Magnetic Susceptability Magnetic susceptability files are easily parsed using standard tools. "],
>>>>>>> 48d80c75e5272ceb7e9b5341d617b4eaec0466b7
["tidying-data.html", "Chapter 3 Tidying Data", " Chapter 3 Tidying Data In the functionality provided by itraxR, the need for data cleaning is much reduced. However, you may still encounter poor quality data that needs removing from subsequent analysis. This can be broadly defined as: Data at the start and end of the the core, where a volume of core material is “missing”. Measurements where the optical configuration is out of position (marked as validity == 0), often due to holes or stones in the core. Areas of the core with low total counts. Individual measurements that are statistical outliers. The easiest way to do this is using a tidyverse style sequence of pipes that set the observations of faulty data as NA. "],
["plotting.html", "Chapter 4 Plotting 4.1 Plotting XRF Data 4.2 Plotting Images", " Chapter 4 Plotting 4.1 Plotting XRF Data 4.2 Plotting Images "],
["transforming-data.html", "Chapter 5 Transforming Data 5.1 Ratios and Normalisation 5.2 Preparing Data for Multivariate Data Analysis", " Chapter 5 Transforming Data 5.1 Ratios and Normalisation 5.2 Preparing Data for Multivariate Data Analysis "],
["multivariate-methods.html", "Chapter 6 Multivariate Methods 6.1 Correlation Coefficients 6.2 Unconstrained Cluster Analysis 6.3 Constrained Cluster Analaysis 6.4 Principle Components Analysis", " Chapter 6 Multivariate Methods 6.1 Correlation Coefficients 6.2 Unconstrained Cluster Analysis 6.3 Constrained Cluster Analaysis 6.4 Principle Components Analysis "],
["calibrating-data.html", "Chapter 7 Calibrating Data 7.1 Suitable Methods 7.2 Linear Methods 7.3 Log-Ratio Methods", " Chapter 7 Calibrating Data 7.1 Suitable Methods 7.2 Linear Methods 7.3 Log-Ratio Methods "],
["transforming-data-1.html", "Chapter 8 Transforming Data 8.1 Ratios and Normalisation 8.2 Preparing Data for Multivariate Data Analysis", " Chapter 8 Transforming Data 8.1 Ratios and Normalisation 8.2 Preparing Data for Multivariate Data Analysis "],
["references.html", "References", " References "]
]
