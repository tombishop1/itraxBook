<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.3 Preparing Data | Using Itrax Data in R</title>
  <meta name="description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  <meta name="generator" content="bookdown 0.28 and GitBook 2.6.7" />

  <meta property="og:title" content="7.3 Preparing Data | Using Itrax Data in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.3 Preparing Data | Using Itrax Data in R" />
  
  <meta name="twitter:description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  

<meta name="author" content="Thomas Bishop" />


<meta name="date" content="2022-08-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="selecting-samples.html"/>
<link rel="next" href="linear-methods.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Using Itrax Data in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="the-itraxr-package.html"><a href="the-itraxr-package.html"><i class="fa fa-check"></i><b>0.1</b> The itraxR Package</a></li>
<li class="chapter" data-level="0.2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>0.2</b> Prerequisites</a></li>
<li class="chapter" data-level="0.3" data-path="example-data.html"><a href="example-data.html"><i class="fa fa-check"></i><b>0.3</b> Example Data</a></li>
<li class="chapter" data-level="0.4" data-path="utility-data.html"><a href="utility-data.html"><i class="fa fa-check"></i><b>0.4</b> Utility Data</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Data Structure</a><ul>
<li class="chapter" data-level="1.1" data-path="metadata.html"><a href="metadata.html"><i class="fa fa-check"></i><b>1.1</b> Metadata</a></li>
<li class="chapter" data-level="1.2" data-path="xrf-data.html"><a href="xrf-data.html"><i class="fa fa-check"></i><b>1.2</b> XRF Data</a></li>
<li class="chapter" data-level="1.3" data-path="optical-images.html"><a href="optical-images.html"><i class="fa fa-check"></i><b>1.3</b> Optical Images</a></li>
<li class="chapter" data-level="1.4" data-path="radiographic-images.html"><a href="radiographic-images.html"><i class="fa fa-check"></i><b>1.4</b> Radiographic Images</a></li>
<li class="chapter" data-level="1.5" data-path="magnetic-susceptability.html"><a href="magnetic-susceptability.html"><i class="fa fa-check"></i><b>1.5</b> Magnetic Susceptability</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="importing.html"><a href="importing.html"><i class="fa fa-check"></i><b>2</b> Importing Data</a><ul>
<li class="chapter" data-level="2.1" data-path="metadata-1.html"><a href="metadata-1.html"><i class="fa fa-check"></i><b>2.1</b> Metadata</a></li>
<li class="chapter" data-level="2.2" data-path="xrf-data-1.html"><a href="xrf-data-1.html"><i class="fa fa-check"></i><b>2.2</b> XRF Data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="xrf-data-1.html"><a href="xrf-data-1.html#processed-data"><i class="fa fa-check"></i><b>2.2.1</b> Processed Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="xrf-data-1.html"><a href="xrf-data-1.html#joining-xrf-data"><i class="fa fa-check"></i><b>2.2.2</b> Joining XRF Data</a></li>
<li class="chapter" data-level="2.2.3" data-path="xrf-data-1.html"><a href="xrf-data-1.html#raw-data"><i class="fa fa-check"></i><b>2.2.3</b> Raw Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="optical-images-1.html"><a href="optical-images-1.html"><i class="fa fa-check"></i><b>2.3</b> Optical Images</a></li>
<li class="chapter" data-level="2.4" data-path="radiographic-images-1.html"><a href="radiographic-images-1.html"><i class="fa fa-check"></i><b>2.4</b> Radiographic Images</a></li>
<li class="chapter" data-level="2.5" data-path="importing-everything.html"><a href="importing-everything.html"><i class="fa fa-check"></i><b>2.5</b> Importing Everything</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidying-data.html"><a href="tidying-data.html"><i class="fa fa-check"></i><b>3</b> Tidying Data</a><ul>
<li class="chapter" data-level="3.1" data-path="low-count-rates.html"><a href="low-count-rates.html"><i class="fa fa-check"></i><b>3.1</b> Low Count Rates</a></li>
<li class="chapter" data-level="3.2" data-path="model-errors-mse.html"><a href="model-errors-mse.html"><i class="fa fa-check"></i><b>3.2</b> Model Errors (MSE)</a></li>
<li class="chapter" data-level="3.3" data-path="surface-slope.html"><a href="surface-slope.html"><i class="fa fa-check"></i><b>3.3</b> Surface Slope</a></li>
<li class="chapter" data-level="3.4" data-path="combining-validity-flags.html"><a href="combining-validity-flags.html"><i class="fa fa-check"></i><b>3.4</b> Combining “Validity” Flags</a></li>
<li class="chapter" data-level="3.5" data-path="tube-current.html"><a href="tube-current.html"><i class="fa fa-check"></i><b>3.5</b> Tube current</a></li>
<li class="chapter" data-level="3.6" data-path="dead-time.html"><a href="dead-time.html"><i class="fa fa-check"></i><b>3.6</b> Dead Time</a></li>
<li class="chapter" data-level="3.7" data-path="correcting-for-water-content.html"><a href="correcting-for-water-content.html"><i class="fa fa-check"></i><b>3.7</b> Correcting for Water Content</a></li>
<li class="chapter" data-level="3.8" data-path="correcting-grain-size.html"><a href="correcting-grain-size.html"><i class="fa fa-check"></i><b>3.8</b> Correcting Grain Size</a></li>
<li class="chapter" data-level="3.9" data-path="uncertainties.html"><a href="uncertainties.html"><i class="fa fa-check"></i><b>3.9</b> Uncertainties</a></li>
<li class="chapter" data-level="3.10" data-path="noisy-data.html"><a href="noisy-data.html"><i class="fa fa-check"></i><b>3.10</b> Noisy Data</a></li>
<li class="chapter" data-level="3.11" data-path="reversing-data.html"><a href="reversing-data.html"><i class="fa fa-check"></i><b>3.11</b> Reversing Data</a></li>
<li class="chapter" data-level="3.12" data-path="visualising-raw-data.html"><a href="visualising-raw-data.html"><i class="fa fa-check"></i><b>3.12</b> Visualising Raw Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>4</b> Plotting</a><ul>
<li class="chapter" data-level="4.1" data-path="plotting-xrf-data.html"><a href="plotting-xrf-data.html"><i class="fa fa-check"></i><b>4.1</b> Plotting XRF Data</a></li>
<li class="chapter" data-level="4.2" data-path="plotting-images.html"><a href="plotting-images.html"><i class="fa fa-check"></i><b>4.2</b> Plotting Images</a></li>
<li class="chapter" data-level="4.3" data-path="combining-images-with-xrf-data.html"><a href="combining-images-with-xrf-data.html"><i class="fa fa-check"></i><b>4.3</b> Combining Images with XRF Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="transforming-data.html"><a href="transforming-data.html"><i class="fa fa-check"></i><b>5</b> Transforming Data</a><ul>
<li class="chapter" data-level="5.1" data-path="ratios-and-normalisation.html"><a href="ratios-and-normalisation.html"><i class="fa fa-check"></i><b>5.1</b> Ratios and Normalisation</a></li>
<li class="chapter" data-level="5.2" data-path="running-mean-and-other-window-functions.html"><a href="running-mean-and-other-window-functions.html"><i class="fa fa-check"></i><b>5.2</b> Running Mean and Other Window Functions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multivariate-methods.html"><a href="multivariate-methods.html"><i class="fa fa-check"></i><b>6</b> Multivariate Methods</a><ul>
<li class="chapter" data-level="6.1" data-path="preparing-data-for-multivariate-data-analysis.html"><a href="preparing-data-for-multivariate-data-analysis.html"><i class="fa fa-check"></i><b>6.1</b> Preparing Data for Multivariate Data Analysis</a></li>
<li class="chapter" data-level="6.2" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html"><i class="fa fa-check"></i><b>6.2</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="6.3" data-path="using-ordr-for-pca.html"><a href="using-ordr-for-pca.html"><i class="fa fa-check"></i><b>6.3</b> Using <code>ordr</code> for PCA</a></li>
<li class="chapter" data-level="6.4" data-path="unconstrained-cluster-analysis.html"><a href="unconstrained-cluster-analysis.html"><i class="fa fa-check"></i><b>6.4</b> Unconstrained Cluster Analysis</a></li>
<li class="chapter" data-level="6.5" data-path="constrained-cluster-analysis.html"><a href="constrained-cluster-analysis.html"><i class="fa fa-check"></i><b>6.5</b> Constrained Cluster Analysis</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="calibrating-data.html"><a href="calibrating-data.html"><i class="fa fa-check"></i><b>7</b> Calibrating Data</a><ul>
<li class="chapter" data-level="7.1" data-path="suitable-methods.html"><a href="suitable-methods.html"><i class="fa fa-check"></i><b>7.1</b> Suitable Methods</a></li>
<li class="chapter" data-level="7.2" data-path="selecting-samples.html"><a href="selecting-samples.html"><i class="fa fa-check"></i><b>7.2</b> Selecting Samples</a></li>
<li class="chapter" data-level="7.3" data-path="preparing-data.html"><a href="preparing-data.html"><i class="fa fa-check"></i><b>7.3</b> Preparing Data</a></li>
<li class="chapter" data-level="7.4" data-path="linear-methods.html"><a href="linear-methods.html"><i class="fa fa-check"></i><b>7.4</b> Linear Methods</a></li>
<li class="chapter" data-level="7.5" data-path="log-ratio-methods.html"><a href="log-ratio-methods.html"><i class="fa fa-check"></i><b>7.5</b> Log-Ratio Methods</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exporting-data.html"><a href="exporting-data.html"><i class="fa fa-check"></i><b>8</b> Exporting Data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using Itrax Data in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="preparing-data" class="section level2 hasAnchor">
<h2><span class="header-section-number">7.3</span> Preparing Data<a href="preparing-data.html#preparing-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to perform empirical calibration it is necessary to have some quantitative data that relates directly to the Itrax XRF data. The quantitative data is unlikely to be at the same resolution as the Itrax XRF data. For example, it is typical to scan cores at between 0.2 and 1 mm, but typical to sub-sample for WD-XRF or ICP at between 5 - 10 mm. In addition, where Itrax scans are contiguous, sub-samples may not be, for example a 10 mm sub-sample might be taken every 80 mm. In this example we have sub-sampled and analysed the 60 samples defined in the previous section. Here they have been freeze-dried, digested in aqua regia using microwave digestion (<span class="citation">Roje (<a href="#ref-Roje2010" role="doc-biblioref">2010</a>)</span>), filtered and analysed using ICP-OES.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="preparing-data.html#cb71-1"></a>icp &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;calibration_samples/calibration_data.csv&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb71-2"><a href="preparing-data.html#cb71-2"></a><span class="st">  </span><span class="co">#select(-`Sample Id`) %&gt;%</span></span>
<span id="cb71-3"><a href="preparing-data.html#cb71-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">water_content =</span> (((wet<span class="op">-</span>tare)<span class="op">-</span>(dry<span class="op">-</span>tare))<span class="op">/</span>(wet<span class="op">-</span>tare))<span class="op">*</span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb71-4"><a href="preparing-data.html#cb71-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(<span class="st">&quot;wet&quot;</span>, <span class="st">&quot;tare&quot;</span>, <span class="st">&quot;dry&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb71-5"><a href="preparing-data.html#cb71-5"></a><span class="st">  </span><span class="co"># remove negative values</span></span>
<span id="cb71-6"><a href="preparing-data.html#cb71-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">any_of</span>(elementsList), <span class="cf">function</span>(x){<span class="kw">replace</span>(x, <span class="kw">which</span>(x<span class="op">&lt;</span><span class="dv">0</span>), <span class="ot">NA</span>)})) <span class="op">%&gt;%</span></span>
<span id="cb71-7"><a href="preparing-data.html#cb71-7"></a><span class="st">  </span><span class="co"># adjust for dilution</span></span>
<span id="cb71-8"><a href="preparing-data.html#cb71-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">any_of</span>(elementsList), <span class="cf">function</span>(x){(x<span class="op">*</span><span class="st">`</span><span class="dt">Dilution</span><span class="st">`</span>)<span class="op">/</span><span class="st">`</span><span class="dt">weight</span><span class="st">`</span>})) <span class="op">%&gt;%</span></span>
<span id="cb71-9"><a href="preparing-data.html#cb71-9"></a><span class="st">  </span><span class="co"># adjust for water content</span></span>
<span id="cb71-10"><a href="preparing-data.html#cb71-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">any_of</span>(elementsList), <span class="cf">function</span>(x){x<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>water_content<span class="op">/</span><span class="dv">100</span>)})) <span class="op">%&gt;%</span></span>
<span id="cb71-11"><a href="preparing-data.html#cb71-11"></a><span class="st">  </span><span class="co"># remove Inf or NaN values</span></span>
<span id="cb71-12"><a href="preparing-data.html#cb71-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">any_of</span>(elementsList), <span class="cf">function</span>(x){<span class="kw">replace</span>(x, <span class="kw">is.infinite</span>(x) <span class="op">|</span><span class="st"> </span><span class="kw">is.nan</span>(x), <span class="ot">NA</span>)})) <span class="op">%&gt;%</span></span>
<span id="cb71-13"><a href="preparing-data.html#cb71-13"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(<span class="st">&quot;weight&quot;</span>, <span class="st">&quot;Dilution&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb71-14"><a href="preparing-data.html#cb71-14"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>top <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;BLANK&quot;</span>, <span class="st">&quot;MESS-4&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb71-15"><a href="preparing-data.html#cb71-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">top =</span> <span class="kw">as.numeric</span>(top), <span class="dt">bot =</span> <span class="kw">as.numeric</span>(bot))</span></code></pre></div>
<pre><code>## Rows: 65 Columns: 39
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (2): top, SampleID
## dbl (37): bot, weight, tare, wet, dry, Dilution, Ag, Al, B, Ba, Bi, Ca, Cd, ...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="preparing-data.html#cb73-1"></a><span class="kw">glimpse</span>(icp)</span></code></pre></div>
<pre><code>## Rows: 60
## Columns: 35
## $ top           &lt;dbl&gt; 330, 430, 440, 460, 670, 770, 800, 840, 930, 1020, 1090,…
## $ bot           &lt;dbl&gt; 340, 440, 450, 470, 680, 780, 810, 850, 940, 1030, 1100,…
## $ SampleID      &lt;chr&gt; &quot;B14&quot;, &quot;A29&quot;, &quot;B01&quot;, &quot;B03&quot;, &quot;A18&quot;, &quot;A20&quot;, &quot;B16&quot;, &quot;A08&quot;, …
## $ Ag            &lt;dbl&gt; 5.415270, 4.785250, 4.594999, 4.342017, 5.529114, 4.8258…
## $ Al            &lt;dbl&gt; 6069.841, 6420.848, 8793.844, 7130.261, 5629.675, 6557.3…
## $ B             &lt;dbl&gt; NA, 0.6380333, NA, NA, 2.7645570, NA, NA, NA, NA, NA, 0.…
## $ Ba            &lt;dbl&gt; 101.53632, 97.93811, 107.32606, 74.81630, 54.25443, 82.0…
## $ Bi            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ Ca            &lt;dbl&gt; 170233.08, 152129.46, 146189.91, 140256.85, 162182.39, 1…
## $ Cd            &lt;dbl&gt; 0.3384544, 0.0000000, 0.3282142, 0.0000000, 0.3455696, 0…
## $ Co            &lt;dbl&gt; 5.415270, 5.742299, 5.579642, 4.342017, 5.529114, 7.5834…
## $ Cr            &lt;dbl&gt; 12.522813, 22.012148, 32.164996, 13.694055, 11.403797, 1…
## $ Cu            &lt;dbl&gt; 16.584265, 15.631815, 15.754284, 12.024048, 18.660759, 2…
## $ Fe            &lt;dbl&gt; 6195.408, 7816.546, 9227.415, 8653.307, 7051.694, 8217.7…
## $ Ga            &lt;dbl&gt; 34.52235, 26.47838, 32.49321, 23.38009, 44.57848, 56.876…
## $ In            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 0.9032826, N…
## $ K             &lt;dbl&gt; 1504.768, 1744.064, 2508.213, 2244.489, 1444.827, 1454.6…
## $ Li            &lt;dbl&gt; 9.476723, 12.122632, 13.456784, 12.692051, 11.749367, 11…
## $ Mg            &lt;dbl&gt; 2504.901, 3840.003, 4673.771, 4586.506, 2908.659, 2888.9…
## $ Mn            &lt;dbl&gt; 281.5941, 274.6733, 272.0896, 213.4269, 199.0481, 372.62…
## $ Na            &lt;dbl&gt; 5742.556, 5555.675, 5723.400, 5228.123, 5576.111, 5440.8…
## $ Ni            &lt;dbl&gt; 9.815177, 13.398699, 14.441427, 11.022044, 11.749367, 15…
## $ Pb            &lt;dbl&gt; NA, NA, NA, NA, NA, 23.095198, NA, NA, NA, NA, 16.424885…
## $ Sr            &lt;dbl&gt; 732.4153, 632.9290, 596.0371, 495.3240, 677.3165, 641.83…
## $ Tl            &lt;dbl&gt; 9.4767230, 4.4662329, 1.9692855, 7.6820307, 4.8379747, N…
## $ Zn            &lt;dbl&gt; 67.35242, 74.33088, 85.66392, 59.11824, 33.52025, 41.709…
## $ Si            &lt;dbl&gt; 504.2970, 188.5388, 340.0300, 527.0541, 286.8228, 264.04…
## $ Ti            &lt;dbl&gt; 422.3911, 342.9429, 374.1642, 293.2532, 526.9937, 649.07…
## $ V             &lt;dbl&gt; 15.90736, 16.26985, 20.34928, 18.03607, 17.27848, 21.026…
## $ Y             &lt;dbl&gt; 6.430633, 6.061316, 6.564285, 4.676019, 5.529114, 6.2046…
## $ Zr            &lt;dbl&gt; 9.476723, 9.251483, 10.502856, 8.016032, 12.094937, 14.8…
## $ S             &lt;dbl&gt; 572.3264, 768.5111, 666.9314, 708.7508, 832.4772, 680.10…
## $ P             &lt;dbl&gt; 166.5196, 182.1585, 220.5600, 202.0708, 196.9747, 186.14…
## $ Mo            &lt;dbl&gt; NA, NA, 2.6257140, NA, NA, NA, NA, NA, NA, NA, NA, 0.602…
## $ water_content &lt;dbl&gt; 30.58300, 30.35867, 31.20629, 28.42351, 30.85152, 29.921…</code></pre>
<p>The function <code>itraxR::itrax_reduce()</code> can be used to reduce the Itrax data to match the resolution of some other data. The example below uses the same positions of the ICP-OES analyses of the data to summarise it. And here is the use of <code>itrax_reduce()</code> to reduce our Itrax XRF data (<code>CD166_19_xrf</code>), using the shape of the “icp” data (in <code>icp</code>). Note the requirement to remove text based columns (in this case <code>file</code> and <code>label</code>) from the data before this step is performed - if the reducing function cannot handle a data type (e.g. passing characters to <code>mean()</code>), errors will occur. If we wanted to add the standard deviation alongside the mean for each chunk, this can be done my modifying the default reducing function (<code>mean()</code>) to <code>sd()</code>, for example:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="preparing-data.html#cb75-1"></a>xrf &lt;-<span class="st"> </span>CD166_<span class="dv">19</span>_xrf <span class="op">%&gt;%</span></span>
<span id="cb75-2"><a href="preparing-data.html#cb75-2"></a><span class="st">  </span><span class="kw">filter</span>(qc <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb75-3"><a href="preparing-data.html#cb75-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(label, filename, uid)) <span class="op">%&gt;%</span></span>
<span id="cb75-4"><a href="preparing-data.html#cb75-4"></a><span class="st">  </span><span class="kw">itrax_reduce</span>(<span class="dt">names =</span> icp<span class="op">$</span>SampleID,</span>
<span id="cb75-5"><a href="preparing-data.html#cb75-5"></a>               <span class="dt">breaks_lower =</span> icp<span class="op">$</span>top,</span>
<span id="cb75-6"><a href="preparing-data.html#cb75-6"></a>               <span class="dt">breaks_upper =</span> icp<span class="op">$</span>bot) <span class="op">%&gt;%</span></span>
<span id="cb75-7"><a href="preparing-data.html#cb75-7"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">SampleID =</span> resample_names) <span class="op">%&gt;%</span></span>
<span id="cb75-8"><a href="preparing-data.html#cb75-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">top =</span> icp<span class="op">$</span>top, </span>
<span id="cb75-9"><a href="preparing-data.html#cb75-9"></a>         <span class="dt">bot =</span> icp<span class="op">$</span>bot)</span>
<span id="cb75-10"><a href="preparing-data.html#cb75-10"></a></span>
<span id="cb75-11"><a href="preparing-data.html#cb75-11"></a><span class="kw">glimpse</span>(xrf)</span></code></pre></div>
<pre><code>## Rows: 60
## Columns: 58
## $ SampleID         &lt;chr&gt; &quot;B14&quot;, &quot;A29&quot;, &quot;B01&quot;, &quot;B03&quot;, &quot;A18&quot;, &quot;A20&quot;, &quot;B16&quot;, &quot;A08…
## $ depth            &lt;dbl&gt; 334.500, 434.500, 444.500, 464.500, 674.500, 774.500,…
## $ MSE              &lt;dbl&gt; 1.707000, 1.585000, 1.562000, 1.499000, 1.644000, 1.5…
## $ cps              &lt;dbl&gt; 46735.90, 38494.00, 36829.50, 34929.50, 44762.00, 450…
## $ validity         &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ Al               &lt;dbl&gt; 79.5000, 71.5000, 78.1000, 57.0000, 77.0000, 87.5000,…
## $ Si               &lt;dbl&gt; 347.4, 929.3, 1338.6, 1043.9, 394.1, 424.5, 375.0, 41…
## $ P                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ S                &lt;dbl&gt; 54.500000, 7.600000, 6.000000, 10.600000, 89.200000, …
## $ Cl               &lt;dbl&gt; 1839.4000, 755.2000, 492.3000, 677.4000, 1781.5000, 1…
## $ Ar               &lt;dbl&gt; 651.4000, 543.7000, 446.4000, 398.8000, 530.5000, 503…
## $ K                &lt;dbl&gt; 2539.800, 3059.000, 3143.800, 3182.900, 2910.600, 288…
## $ Ca               &lt;dbl&gt; 234113.7, 157804.5, 97585.4, 115428.4, 202283.5, 2034…
## $ Sc               &lt;dbl&gt; 0.000000, 0.000000, 0.000000, 0.000000, 10.100000, 0.…
## $ Ti               &lt;dbl&gt; 1723.80, 1936.00, 4692.80, 1964.60, 2398.60, 2549.20,…
## $ V                &lt;dbl&gt; 15.5000, 59.0000, 116.6000, 77.9000, 26.2000, 56.6000…
## $ Cr               &lt;dbl&gt; 309.600, 260.200, 329.800, 278.600, 343.100, 314.900,…
## $ Mn               &lt;dbl&gt; 743.800, 580.300, 794.100, 796.100, 597.400, 910.300,…
## $ Fe               &lt;dbl&gt; 32624.9, 43792.7, 74938.8, 44888.9, 40525.2, 45688.0,…
## $ Ni               &lt;dbl&gt; 98.3, 65.7, 77.2, 92.3, 86.3, 108.4, 123.6, 114.2, 17…
## $ Cu               &lt;dbl&gt; 191.6000, 90.3000, 94.3000, 80.6000, 171.4000, 202.80…
## $ Zn               &lt;dbl&gt; 145.4000, 163.5000, 171.5000, 177.8000, 161.8000, 179…
## $ Ga               &lt;dbl&gt; 9.50000, 80.80000, 110.20000, 72.10000, 19.60000, 23.…
## $ Ge               &lt;dbl&gt; 73.60000, 103.10000, 107.70000, 104.20000, 95.50000, …
## $ Br               &lt;dbl&gt; 494.0000, 287.1000, 204.8000, 260.3000, 483.4000, 431…
## $ Rb               &lt;dbl&gt; 196.6000, 295.8000, 404.3000, 375.9000, 201.0000, 221…
## $ Sr               &lt;dbl&gt; 11406.200, 6618.700, 4505.500, 5548.200, 10746.500, 1…
## $ Y                &lt;dbl&gt; 109.9000, 97.8000, 108.0000, 52.5000, 156.0000, 126.7…
## $ Zr               &lt;dbl&gt; 208.0, 413.4, 2082.7, 456.9, 257.6, 320.7, 294.2, 301…
## $ Pd               &lt;dbl&gt; 79.90000, 43.00000, 25.80000, 31.40000, 72.00000, 63.…
## $ Cd               &lt;dbl&gt; 111.50000, 88.60000, 44.80000, 56.30000, 83.50000, 88…
## $ I                &lt;dbl&gt; 57.10000, 54.80000, 27.50000, 28.90000, 70.60000, 61.…
## $ Cs               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ Ba               &lt;dbl&gt; 29.7000, 44.3000, 111.6000, 72.4000, 31.7000, 53.1000…
## $ Nd               &lt;dbl&gt; 34.30000, 20.90000, 46.10000, 32.50000, 27.50000, 31.…
## $ Sm               &lt;dbl&gt; 6.9000, 47.8000, 82.8000, 50.0000, 15.6000, 18.5000, …
## $ Yb               &lt;dbl&gt; 345.3000, 276.6000, 205.2000, 178.5000, 285.1000, 264…
## $ Ta               &lt;dbl&gt; 727.9000, 659.0000, 603.8000, 630.3000, 746.6000, 688…
## $ W                &lt;dbl&gt; 2288.200, 2044.000, 2001.000, 2056.400, 2153.300, 209…
## $ Pb               &lt;dbl&gt; 63.70000, 64.70000, 109.20000, 66.60000, 55.00000, 87…
## $ Bi               &lt;dbl&gt; 162.0000, 123.9000, 136.1000, 124.1000, 148.2000, 139…
## $ `Mo inc`         &lt;dbl&gt; 26754.90, 23616.20, 21588.20, 23656.80, 26309.50, 256…
## $ `Mo coh`         &lt;dbl&gt; 10207.900, 9466.900, 8911.000, 9174.500, 9985.400, 98…
## $ position         &lt;dbl&gt; 366.0400, 466.0400, 476.0400, 496.0400, 706.0400, 806…
## $ `sample surface` &lt;dbl&gt; 6.498, 6.000, 6.005, 6.080, 6.466, 6.484, 6.476, 6.51…
## $ `E-gain`         &lt;dbl&gt; 0.010267, 0.010267, 0.010267, 0.010267, 0.010267, 0.0…
## $ `E-offset`       &lt;dbl&gt; -0.009931, -0.009931, -0.009931, -0.009931, -0.009931…
## $ `F-slope`        &lt;dbl&gt; 0.0099, 0.0099, 0.0099, 0.0099, 0.0099, 0.0099, 0.009…
## $ `F-offset`       &lt;dbl&gt; 0.077115, 0.077115, 0.077115, 0.077115, 0.077115, 0.0…
## $ `Fe a*2`         &lt;dbl&gt; 158.6000, 74.1000, 132.1000, 167.6000, 158.4000, 118.…
## $ `Fe a+b`         &lt;dbl&gt; 82.2000, 139.4000, 111.5000, 146.1000, 136.0000, 146.…
## $ S1               &lt;dbl&gt; 306.600, 311.300, 475.100, 303.500, 318.900, 370.900,…
## $ S2               &lt;dbl&gt; 219.8000, 199.8000, 299.0000, 209.5000, 244.8000, 263…
## $ S3               &lt;dbl&gt; 252.700, 298.400, 430.000, 337.400, 261.100, 340.600,…
## $ Dt               &lt;dbl&gt; 0.10210000, 0.09900000, 0.09790000, 0.10170000, 0.102…
## $ qc               &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
## $ top              &lt;dbl&gt; 330, 430, 440, 460, 670, 770, 800, 840, 930, 1020, 10…
## $ bot              &lt;dbl&gt; 340, 440, 450, 470, 680, 780, 810, 850, 940, 1030, 11…</code></pre>
<p>It is worth reading <code>?itraxR::itrax_reduce()</code> as the behaviour can and should be modified depending on your exact use case. For example, in th situation above where none of the samples are contiguous it might be wise to modify the parameters of <code>itraxR::itrax_reduce()</code> to include <code>edges = c("&gt;=", "&lt;=")</code> so that the “edges” of the sub-samples are captured. This might not be the case for contiguous samples in order to avoid “double-counting”.</p>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references">
<div id="ref-Roje2010">
<p>Roje, V. 2010. “Multi-Elemental Analysis of Marine Sediment Reference Material Mess-3: One-Step Microwave Digestion and Determination by High Resolution Inductively Coupled Plasma-Mass Spectrometry (Hr-Icp-Ms).” <em>Chemical Papers</em> 64: 41–50. <a href="https://doi.org/10.2478/s11696-010-0022-x">https://doi.org/10.2478/s11696-010-0022-x</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="selecting-samples.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["itraxBook.pdf", "itraxBook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
