<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.2 Selecting Samples | Using Itrax Data in R</title>
  <meta name="description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="7.2 Selecting Samples | Using Itrax Data in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.2 Selecting Samples | Using Itrax Data in R" />
  
  <meta name="twitter:description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  

<meta name="author" content="Thomas Bishop" />


<meta name="date" content="2024-05-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="suitable-methods.html"/>
<link rel="next" href="preparing-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Using Itrax Data in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="0.1" data-path="the-itraxr-package.html"><a href="the-itraxr-package.html"><i class="fa fa-check"></i><b>0.1</b> The itraxR Package</a></li>
<li class="chapter" data-level="0.2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>0.2</b> Prerequisites</a></li>
<li class="chapter" data-level="0.3" data-path="example-data.html"><a href="example-data.html"><i class="fa fa-check"></i><b>0.3</b> Example Data</a></li>
<li class="chapter" data-level="0.4" data-path="utility-data.html"><a href="utility-data.html"><i class="fa fa-check"></i><b>0.4</b> Utility Data</a></li>
<li class="chapter" data-level="0.5" data-path="citing-this-work.html"><a href="citing-this-work.html"><i class="fa fa-check"></i><b>0.5</b> Citing This Work</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Data Structure</a>
<ul>
<li class="chapter" data-level="1.1" data-path="metadata.html"><a href="metadata.html"><i class="fa fa-check"></i><b>1.1</b> Metadata</a></li>
<li class="chapter" data-level="1.2" data-path="xrf-data.html"><a href="xrf-data.html"><i class="fa fa-check"></i><b>1.2</b> XRF Data</a></li>
<li class="chapter" data-level="1.3" data-path="optical-images.html"><a href="optical-images.html"><i class="fa fa-check"></i><b>1.3</b> Optical Images</a></li>
<li class="chapter" data-level="1.4" data-path="radiographic-images.html"><a href="radiographic-images.html"><i class="fa fa-check"></i><b>1.4</b> Radiographic Images</a></li>
<li class="chapter" data-level="1.5" data-path="magnetic-susceptability.html"><a href="magnetic-susceptability.html"><i class="fa fa-check"></i><b>1.5</b> Magnetic Susceptability</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="importing.html"><a href="importing.html"><i class="fa fa-check"></i><b>2</b> Importing Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="metadata-1.html"><a href="metadata-1.html"><i class="fa fa-check"></i><b>2.1</b> Metadata</a></li>
<li class="chapter" data-level="2.2" data-path="xrf-data-1.html"><a href="xrf-data-1.html"><i class="fa fa-check"></i><b>2.2</b> XRF Data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="xrf-data-1.html"><a href="xrf-data-1.html#processed-data"><i class="fa fa-check"></i><b>2.2.1</b> Processed Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="xrf-data-1.html"><a href="xrf-data-1.html#joining-xrf-data"><i class="fa fa-check"></i><b>2.2.2</b> Joining XRF Data</a></li>
<li class="chapter" data-level="2.2.3" data-path="xrf-data-1.html"><a href="xrf-data-1.html#raw-data"><i class="fa fa-check"></i><b>2.2.3</b> Raw Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="optical-images-1.html"><a href="optical-images-1.html"><i class="fa fa-check"></i><b>2.3</b> Optical Images</a></li>
<li class="chapter" data-level="2.4" data-path="radiographic-images-1.html"><a href="radiographic-images-1.html"><i class="fa fa-check"></i><b>2.4</b> Radiographic Images</a></li>
<li class="chapter" data-level="2.5" data-path="importing-everything.html"><a href="importing-everything.html"><i class="fa fa-check"></i><b>2.5</b> Importing Everything</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidying-data.html"><a href="tidying-data.html"><i class="fa fa-check"></i><b>3</b> Tidying Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="low-count-rates.html"><a href="low-count-rates.html"><i class="fa fa-check"></i><b>3.1</b> Low Count Rates</a></li>
<li class="chapter" data-level="3.2" data-path="model-errors-mse.html"><a href="model-errors-mse.html"><i class="fa fa-check"></i><b>3.2</b> Model Errors (MSE)</a></li>
<li class="chapter" data-level="3.3" data-path="surface-slope.html"><a href="surface-slope.html"><i class="fa fa-check"></i><b>3.3</b> Surface Slope</a></li>
<li class="chapter" data-level="3.4" data-path="high-argon.html"><a href="high-argon.html"><i class="fa fa-check"></i><b>3.4</b> High Argon</a></li>
<li class="chapter" data-level="3.5" data-path="combining-validity-flags.html"><a href="combining-validity-flags.html"><i class="fa fa-check"></i><b>3.5</b> Combining “Validity” Flags</a></li>
<li class="chapter" data-level="3.6" data-path="tube-current.html"><a href="tube-current.html"><i class="fa fa-check"></i><b>3.6</b> Tube current</a></li>
<li class="chapter" data-level="3.7" data-path="dead-time.html"><a href="dead-time.html"><i class="fa fa-check"></i><b>3.7</b> Dead Time</a></li>
<li class="chapter" data-level="3.8" data-path="correcting-for-water-content.html"><a href="correcting-for-water-content.html"><i class="fa fa-check"></i><b>3.8</b> Correcting for Water Content</a></li>
<li class="chapter" data-level="3.9" data-path="correcting-grain-size.html"><a href="correcting-grain-size.html"><i class="fa fa-check"></i><b>3.9</b> Correcting Grain Size</a></li>
<li class="chapter" data-level="3.10" data-path="uncertainties.html"><a href="uncertainties.html"><i class="fa fa-check"></i><b>3.10</b> Uncertainties</a></li>
<li class="chapter" data-level="3.11" data-path="noisy-data.html"><a href="noisy-data.html"><i class="fa fa-check"></i><b>3.11</b> Noisy Data</a></li>
<li class="chapter" data-level="3.12" data-path="reversing-data.html"><a href="reversing-data.html"><i class="fa fa-check"></i><b>3.12</b> Reversing Data</a></li>
<li class="chapter" data-level="3.13" data-path="visualising-raw-data.html"><a href="visualising-raw-data.html"><i class="fa fa-check"></i><b>3.13</b> Visualising Raw Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>4</b> Plotting</a>
<ul>
<li class="chapter" data-level="4.1" data-path="plotting-xrf-data.html"><a href="plotting-xrf-data.html"><i class="fa fa-check"></i><b>4.1</b> Plotting XRF Data</a></li>
<li class="chapter" data-level="4.2" data-path="plotting-images.html"><a href="plotting-images.html"><i class="fa fa-check"></i><b>4.2</b> Plotting Images</a></li>
<li class="chapter" data-level="4.3" data-path="combining-images-with-xrf-data.html"><a href="combining-images-with-xrf-data.html"><i class="fa fa-check"></i><b>4.3</b> Combining Images with XRF Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="transforming-data.html"><a href="transforming-data.html"><i class="fa fa-check"></i><b>5</b> Transforming Data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ratios-and-normalisation.html"><a href="ratios-and-normalisation.html"><i class="fa fa-check"></i><b>5.1</b> Ratios and Normalisation</a></li>
<li class="chapter" data-level="5.2" data-path="running-mean-and-other-window-functions.html"><a href="running-mean-and-other-window-functions.html"><i class="fa fa-check"></i><b>5.2</b> Running Mean and Other Window Functions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multivariate-methods.html"><a href="multivariate-methods.html"><i class="fa fa-check"></i><b>6</b> Multivariate Methods</a>
<ul>
<li class="chapter" data-level="6.1" data-path="preparing-data-for-multivariate-data-analysis.html"><a href="preparing-data-for-multivariate-data-analysis.html"><i class="fa fa-check"></i><b>6.1</b> Preparing Data for Multivariate Data Analysis</a></li>
<li class="chapter" data-level="6.2" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html"><i class="fa fa-check"></i><b>6.2</b> Principal Component Analysis</a></li>
<li class="chapter" data-level="6.3" data-path="using-ordr-for-pca.html"><a href="using-ordr-for-pca.html"><i class="fa fa-check"></i><b>6.3</b> Using <code>ordr</code> for PCA</a></li>
<li class="chapter" data-level="6.4" data-path="unconstrained-cluster-analysis.html"><a href="unconstrained-cluster-analysis.html"><i class="fa fa-check"></i><b>6.4</b> Unconstrained Cluster Analysis</a></li>
<li class="chapter" data-level="6.5" data-path="constrained-cluster-analysis.html"><a href="constrained-cluster-analysis.html"><i class="fa fa-check"></i><b>6.5</b> Constrained Cluster Analysis</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="calibrating-data.html"><a href="calibrating-data.html"><i class="fa fa-check"></i><b>7</b> Calibrating Data</a>
<ul>
<li class="chapter" data-level="7.1" data-path="suitable-methods.html"><a href="suitable-methods.html"><i class="fa fa-check"></i><b>7.1</b> Suitable Methods</a></li>
<li class="chapter" data-level="7.2" data-path="selecting-samples.html"><a href="selecting-samples.html"><i class="fa fa-check"></i><b>7.2</b> Selecting Samples</a></li>
<li class="chapter" data-level="7.3" data-path="preparing-data.html"><a href="preparing-data.html"><i class="fa fa-check"></i><b>7.3</b> Preparing Data</a></li>
<li class="chapter" data-level="7.4" data-path="linear-methods.html"><a href="linear-methods.html"><i class="fa fa-check"></i><b>7.4</b> Linear Methods</a></li>
<li class="chapter" data-level="7.5" data-path="log-ratio-methods.html"><a href="log-ratio-methods.html"><i class="fa fa-check"></i><b>7.5</b> Log-Ratio Methods</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exporting-data.html"><a href="exporting-data.html"><i class="fa fa-check"></i><b>8</b> Exporting Data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using Itrax Data in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="selecting-samples" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Selecting Samples<a href="selecting-samples.html#selecting-samples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Unless you plan on sub-sampling the entire core, perhaps contiguously, you will need to decide where best to take your samples for best model coverage. If you are only interested in a single element, this is trivial - simply ensure your sampling strategy encompasses a wide range of samples. However, where you are attempting to calibrate for many elements, developing an optimal sampling strategy manually can be difficult.</p>
<p>The function below illustrates the use of cluster analysis in optimising the sampling regime. Because it is unrealistic to plan on accurately sub-sampling at the high-resolution of the data (in this case, 1 mm), we use <code>itrax_reduce()</code> to re sample the data to a lower resolution, in this case, 10 mm.</p>
<p>The following <code>itrax_section()</code> performs an unconstrained cluster analysis, and also reports the central sample in each cluster. This could be considered the most representative of each cluster, and thus the suitable location for sampling. In the graph below, the black ticks created by <code>geom_rug()</code> are the suggested sampling locations.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="selecting-samples.html#cb77-1" tabindex="-1"></a>CD166_19_xrf <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="selecting-samples.html#cb77-2" tabindex="-1"></a>  <span class="fu">filter</span>(qc <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="selecting-samples.html#cb77-3" tabindex="-1"></a>  <span class="fu">itrax_reduce</span>(<span class="at">by =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="selecting-samples.html#cb77-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uid =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(uid)) <span class="sc">%&gt;%</span> <span class="co"># we have to spoof uid here</span></span>
<span id="cb77-5"><a href="selecting-samples.html#cb77-5" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="st">&quot;depth&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-6"><a href="selecting-samples.html#cb77-6" tabindex="-1"></a>  <span class="fu">itrax_section</span>(<span class="at">divisions =</span> <span class="dv">60</span>, </span>
<span id="cb77-7"><a href="selecting-samples.html#cb77-7" tabindex="-1"></a>                <span class="at">elementsonly =</span> <span class="fu">c</span>(<span class="st">&quot;Al&quot;</span>, <span class="st">&quot;Si&quot;</span>, <span class="st">&quot;K&quot;</span> , <span class="st">&quot;Ca&quot;</span>, <span class="st">&quot;Ti&quot;</span>, </span>
<span id="cb77-8"><a href="selecting-samples.html#cb77-8" tabindex="-1"></a>                                 <span class="st">&quot;V&quot;</span> , <span class="st">&quot;Cr&quot;</span>, <span class="st">&quot;Mn&quot;</span>, <span class="st">&quot;Fe&quot;</span>, <span class="st">&quot;Ni&quot;</span>, </span>
<span id="cb77-9"><a href="selecting-samples.html#cb77-9" tabindex="-1"></a>                                 <span class="st">&quot;Cu&quot;</span>, <span class="st">&quot;Zn&quot;</span>,<span class="st">&quot;Sr&quot;</span> , <span class="st">&quot;Y&quot;</span> , <span class="st">&quot;Zr&quot;</span>, </span>
<span id="cb77-10"><a href="selecting-samples.html#cb77-10" tabindex="-1"></a>                                 <span class="st">&quot;Ba&quot;</span>)</span>
<span id="cb77-11"><a href="selecting-samples.html#cb77-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb77-12"><a href="selecting-samples.html#cb77-12" tabindex="-1"></a>  </span>
<span id="cb77-13"><a href="selecting-samples.html#cb77-13" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> depth, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">fill =</span> group)) <span class="sc">+</span> </span>
<span id="cb77-14"><a href="selecting-samples.html#cb77-14" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">width =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb77-15"><a href="selecting-samples.html#cb77-15" tabindex="-1"></a>  <span class="fu">scale_x_reverse</span>() <span class="sc">+</span></span>
<span id="cb77-16"><a href="selecting-samples.html#cb77-16" tabindex="-1"></a>    <span class="fu">geom_rug</span>(<span class="at">sides =</span> <span class="st">&quot;b&quot;</span>, </span>
<span id="cb77-17"><a href="selecting-samples.html#cb77-17" tabindex="-1"></a>             <span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(calib_sample <span class="sc">==</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb77-18"><a href="selecting-samples.html#cb77-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-19"><a href="selecting-samples.html#cb77-19" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-20"><a href="selecting-samples.html#cb77-20" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb77-21"><a href="selecting-samples.html#cb77-21" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span></code></pre></div>
<p><img src="itraxBook_files/figure-html/calib_optimisation-1.png" width="672" /></p>
<p>To return a core sampling plan, some conversions must be performed:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="selecting-samples.html#cb78-1" tabindex="-1"></a>CD166_19_xrf <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="selecting-samples.html#cb78-2" tabindex="-1"></a>  <span class="fu">filter</span>(qc <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="selecting-samples.html#cb78-3" tabindex="-1"></a>  <span class="fu">itrax_reduce</span>(<span class="at">breaks_lower =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4209-10</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb78-4"><a href="selecting-samples.html#cb78-4" tabindex="-1"></a>               <span class="at">breaks_upper =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span><span class="sc">+</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">4209</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-5"><a href="selecting-samples.html#cb78-5" tabindex="-1"></a>  <span class="co"># this needs a method for simply adding all the character vectors from each chunk together into a vector...</span></span>
<span id="cb78-6"><a href="selecting-samples.html#cb78-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">uid =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(uid)) <span class="sc">%&gt;%</span></span>
<span id="cb78-7"><a href="selecting-samples.html#cb78-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">breaks_lower =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4209-10</span>, <span class="at">by =</span> <span class="dv">10</span>),</span>
<span id="cb78-8"><a href="selecting-samples.html#cb78-8" tabindex="-1"></a>         <span class="at">breaks_upper =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span><span class="sc">+</span><span class="dv">10</span>, <span class="at">to =</span> <span class="dv">4209</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">%&gt;%</span> <span class="co"># we have to spoof uid here</span></span>
<span id="cb78-9"><a href="selecting-samples.html#cb78-9" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="st">&quot;depth&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-10"><a href="selecting-samples.html#cb78-10" tabindex="-1"></a>  <span class="fu">itrax_section</span>(<span class="at">divisions =</span> <span class="dv">60</span>, </span>
<span id="cb78-11"><a href="selecting-samples.html#cb78-11" tabindex="-1"></a>                <span class="at">elementsonly =</span> <span class="fu">c</span>(<span class="st">&quot;Al&quot;</span>, <span class="st">&quot;Si&quot;</span>, <span class="st">&quot;K&quot;</span> , <span class="st">&quot;Ca&quot;</span>, <span class="st">&quot;Ti&quot;</span>, </span>
<span id="cb78-12"><a href="selecting-samples.html#cb78-12" tabindex="-1"></a>                                 <span class="st">&quot;V&quot;</span> , <span class="st">&quot;Cr&quot;</span>, <span class="st">&quot;Mn&quot;</span>, <span class="st">&quot;Fe&quot;</span>, <span class="st">&quot;Ni&quot;</span>, </span>
<span id="cb78-13"><a href="selecting-samples.html#cb78-13" tabindex="-1"></a>                                 <span class="st">&quot;Cu&quot;</span>, <span class="st">&quot;Zn&quot;</span>,<span class="st">&quot;Sr&quot;</span> , <span class="st">&quot;Y&quot;</span> , <span class="st">&quot;Zr&quot;</span>, </span>
<span id="cb78-14"><a href="selecting-samples.html#cb78-14" tabindex="-1"></a>                                 <span class="st">&quot;Ba&quot;</span>)</span>
<span id="cb78-15"><a href="selecting-samples.html#cb78-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb78-16"><a href="selecting-samples.html#cb78-16" tabindex="-1"></a>  <span class="fu">filter</span>(calib_sample <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-17"><a href="selecting-samples.html#cb78-17" tabindex="-1"></a>  <span class="fu">select</span>(group, depth, breaks_lower, breaks_upper, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb78-18"><a href="selecting-samples.html#cb78-18" tabindex="-1"></a>  <span class="fu">arrange</span>(depth) <span class="sc">%&gt;%</span></span>
<span id="cb78-19"><a href="selecting-samples.html#cb78-19" tabindex="-1"></a>  <span class="fu">select</span>(breaks_lower, breaks_upper) <span class="sc">%&gt;%</span></span>
<span id="cb78-20"><a href="selecting-samples.html#cb78-20" tabindex="-1"></a>  </span>
<span id="cb78-21"><a href="selecting-samples.html#cb78-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core =</span> <span class="fu">if_else</span>(breaks_upper <span class="sc">&gt;=</span> <span class="fu">min</span>(CD166_19_S1<span class="sc">$</span>xrf<span class="sc">$</span>depth) <span class="sc">&amp;</span> breaks_upper <span class="sc">&lt;=</span> <span class="fu">max</span>(CD166_19_S1<span class="sc">$</span>xrf<span class="sc">$</span>depth), <span class="st">&quot;c1&quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-22"><a href="selecting-samples.html#cb78-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core =</span> <span class="fu">if_else</span>(breaks_upper <span class="sc">&gt;=</span> <span class="fu">min</span>(CD166_19_S2<span class="sc">$</span>xrf<span class="sc">$</span>depth) <span class="sc">&amp;</span> breaks_upper <span class="sc">&lt;=</span> <span class="fu">max</span>(CD166_19_S2<span class="sc">$</span>xrf<span class="sc">$</span>depth), <span class="st">&quot;c2&quot;</span>, core)) <span class="sc">%&gt;%</span></span>
<span id="cb78-23"><a href="selecting-samples.html#cb78-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core =</span> <span class="fu">if_else</span>(breaks_upper <span class="sc">&gt;=</span> <span class="fu">min</span>(CD166_19_S3<span class="sc">$</span>xrf<span class="sc">$</span>depth) <span class="sc">&amp;</span> breaks_upper <span class="sc">&lt;=</span> <span class="fu">max</span>(CD166_19_S3<span class="sc">$</span>xrf<span class="sc">$</span>depth), <span class="st">&quot;c3&quot;</span>, core)) <span class="sc">%&gt;%</span></span>
<span id="cb78-24"><a href="selecting-samples.html#cb78-24" tabindex="-1"></a>  </span>
<span id="cb78-25"><a href="selecting-samples.html#cb78-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core_position_lower =</span> <span class="fu">ifelse</span>(core <span class="sc">==</span> <span class="st">&quot;c1&quot;</span>, breaks_lower<span class="sc">-</span><span class="fu">min</span>(CD166_19_S1<span class="sc">$</span>xrf<span class="sc">$</span>depth), <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-26"><a href="selecting-samples.html#cb78-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core_position_lower =</span> <span class="fu">ifelse</span>(core <span class="sc">==</span> <span class="st">&quot;c2&quot;</span>, breaks_lower<span class="sc">-</span><span class="fu">min</span>(CD166_19_S2<span class="sc">$</span>xrf<span class="sc">$</span>depth), core_position_lower)) <span class="sc">%&gt;%</span></span>
<span id="cb78-27"><a href="selecting-samples.html#cb78-27" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core_position_lower =</span> <span class="fu">ifelse</span>(core <span class="sc">==</span> <span class="st">&quot;c3&quot;</span>, breaks_lower<span class="sc">-</span><span class="fu">min</span>(CD166_19_S3<span class="sc">$</span>xrf<span class="sc">$</span>depth), core_position_lower)) <span class="sc">%&gt;%</span></span>
<span id="cb78-28"><a href="selecting-samples.html#cb78-28" tabindex="-1"></a>  </span>
<span id="cb78-29"><a href="selecting-samples.html#cb78-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core_position_upper =</span> <span class="fu">ifelse</span>(core <span class="sc">==</span> <span class="st">&quot;c1&quot;</span>, breaks_upper<span class="sc">-</span><span class="fu">min</span>(CD166_19_S1<span class="sc">$</span>xrf<span class="sc">$</span>depth), <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-30"><a href="selecting-samples.html#cb78-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core_position_upper =</span> <span class="fu">ifelse</span>(core <span class="sc">==</span> <span class="st">&quot;c2&quot;</span>, breaks_upper<span class="sc">-</span><span class="fu">min</span>(CD166_19_S2<span class="sc">$</span>xrf<span class="sc">$</span>depth), core_position_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb78-31"><a href="selecting-samples.html#cb78-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">core_position_upper =</span> <span class="fu">ifelse</span>(core <span class="sc">==</span> <span class="st">&quot;c3&quot;</span>, breaks_upper<span class="sc">-</span><span class="fu">min</span>(CD166_19_S3<span class="sc">$</span>xrf<span class="sc">$</span>depth), core_position_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb78-32"><a href="selecting-samples.html#cb78-32" tabindex="-1"></a>  </span>
<span id="cb78-33"><a href="selecting-samples.html#cb78-33" tabindex="-1"></a>  <span class="fu">select</span>(core, core_position_lower, core_position_upper)</span></code></pre></div>
<pre><code>## # A tibble: 60 × 3
##    core  core_position_lower core_position_upper
##    &lt;chr&gt;               &lt;dbl&gt;               &lt;dbl&gt;
##  1 c1                     80                  90
##  2 c1                    330                 340
##  3 c1                    430                 440
##  4 c1                    440                 450
##  5 c1                    460                 470
##  6 c1                    670                 680
##  7 c1                    770                 780
##  8 c1                    840                 850
##  9 c1                    930                 940
## 10 c1                   1020                1030
## # ℹ 50 more rows</code></pre>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="suitable-methods.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="preparing-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["itraxBook.pdf", "itraxBook.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
