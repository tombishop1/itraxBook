<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.10 Noisy Data | Using Itrax Data in R</title>
  <meta name="description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="3.10 Noisy Data | Using Itrax Data in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.10 Noisy Data | Using Itrax Data in R" />
  
  <meta name="twitter:description" content="This book is a guide to importing, tidying, manipulating and analysing Itrax core scanner data in R." />
  

<meta name="author" content="Thomas Bishop" />


<meta name="date" content="2021-05-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="uncertainties.html"/>
<link rel="next" href="reversing-data.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Using Itrax Data in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="the-itraxr-package.html"><a href="the-itraxr-package.html"><i class="fa fa-check"></i><b>0.1</b> The itraxR Package</a></li>
<li class="chapter" data-level="0.2" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>0.2</b> Prerequisites</a></li>
<li class="chapter" data-level="0.3" data-path="example-data.html"><a href="example-data.html"><i class="fa fa-check"></i><b>0.3</b> Example Data</a></li>
<li class="chapter" data-level="0.4" data-path="utility-data.html"><a href="utility-data.html"><i class="fa fa-check"></i><b>0.4</b> Utility Data</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Data Structure</a><ul>
<li class="chapter" data-level="1.1" data-path="metadata.html"><a href="metadata.html"><i class="fa fa-check"></i><b>1.1</b> Metadata</a></li>
<li class="chapter" data-level="1.2" data-path="xrf-data.html"><a href="xrf-data.html"><i class="fa fa-check"></i><b>1.2</b> XRF Data</a></li>
<li class="chapter" data-level="1.3" data-path="optical-images.html"><a href="optical-images.html"><i class="fa fa-check"></i><b>1.3</b> Optical Images</a></li>
<li class="chapter" data-level="1.4" data-path="radiographic-images.html"><a href="radiographic-images.html"><i class="fa fa-check"></i><b>1.4</b> Radiographic Images</a></li>
<li class="chapter" data-level="1.5" data-path="magnetic-susceptability.html"><a href="magnetic-susceptability.html"><i class="fa fa-check"></i><b>1.5</b> Magnetic Susceptability</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="importing.html"><a href="importing.html"><i class="fa fa-check"></i><b>2</b> Importing Data</a><ul>
<li class="chapter" data-level="2.1" data-path="metadata-1.html"><a href="metadata-1.html"><i class="fa fa-check"></i><b>2.1</b> Metadata</a></li>
<li class="chapter" data-level="2.2" data-path="xrf-data-1.html"><a href="xrf-data-1.html"><i class="fa fa-check"></i><b>2.2</b> XRF Data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="xrf-data-1.html"><a href="xrf-data-1.html#processed-data"><i class="fa fa-check"></i><b>2.2.1</b> Processed Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="xrf-data-1.html"><a href="xrf-data-1.html#joining-xrf-data"><i class="fa fa-check"></i><b>2.2.2</b> Joining XRF Data</a></li>
<li class="chapter" data-level="2.2.3" data-path="xrf-data-1.html"><a href="xrf-data-1.html#raw-data"><i class="fa fa-check"></i><b>2.2.3</b> Raw Data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="optical-images-1.html"><a href="optical-images-1.html"><i class="fa fa-check"></i><b>2.3</b> Optical Images</a></li>
<li class="chapter" data-level="2.4" data-path="radiographic-images-1.html"><a href="radiographic-images-1.html"><i class="fa fa-check"></i><b>2.4</b> Radiographic Images</a></li>
<li class="chapter" data-level="2.5" data-path="importing-everything.html"><a href="importing-everything.html"><i class="fa fa-check"></i><b>2.5</b> Importing Everything</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tidying-data.html"><a href="tidying-data.html"><i class="fa fa-check"></i><b>3</b> Tidying Data</a><ul>
<li class="chapter" data-level="3.1" data-path="low-count-rates.html"><a href="low-count-rates.html"><i class="fa fa-check"></i><b>3.1</b> Low Count Rates</a></li>
<li class="chapter" data-level="3.2" data-path="model-errors-mse.html"><a href="model-errors-mse.html"><i class="fa fa-check"></i><b>3.2</b> Model Errors (MSE)</a></li>
<li class="chapter" data-level="3.3" data-path="surface-slope.html"><a href="surface-slope.html"><i class="fa fa-check"></i><b>3.3</b> Surface Slope</a></li>
<li class="chapter" data-level="3.4" data-path="combining-validity-flags.html"><a href="combining-validity-flags.html"><i class="fa fa-check"></i><b>3.4</b> Combining “Validity” Flags</a></li>
<li class="chapter" data-level="3.5" data-path="tube-current.html"><a href="tube-current.html"><i class="fa fa-check"></i><b>3.5</b> Tube current</a></li>
<li class="chapter" data-level="3.6" data-path="dead-time.html"><a href="dead-time.html"><i class="fa fa-check"></i><b>3.6</b> Dead Time</a></li>
<li class="chapter" data-level="3.7" data-path="correcting-for-water-content.html"><a href="correcting-for-water-content.html"><i class="fa fa-check"></i><b>3.7</b> Correcting for Water Content</a></li>
<li class="chapter" data-level="3.8" data-path="correcting-grain-size.html"><a href="correcting-grain-size.html"><i class="fa fa-check"></i><b>3.8</b> Correcting Grain Size</a></li>
<li class="chapter" data-level="3.9" data-path="uncertainties.html"><a href="uncertainties.html"><i class="fa fa-check"></i><b>3.9</b> Uncertainties</a></li>
<li class="chapter" data-level="3.10" data-path="noisy-data.html"><a href="noisy-data.html"><i class="fa fa-check"></i><b>3.10</b> Noisy Data</a></li>
<li class="chapter" data-level="3.11" data-path="reversing-data.html"><a href="reversing-data.html"><i class="fa fa-check"></i><b>3.11</b> Reversing Data</a></li>
<li class="chapter" data-level="3.12" data-path="visualising-raw-data.html"><a href="visualising-raw-data.html"><i class="fa fa-check"></i><b>3.12</b> Visualising Raw Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="plotting.html"><a href="plotting.html"><i class="fa fa-check"></i><b>4</b> Plotting</a><ul>
<li class="chapter" data-level="4.1" data-path="plotting-xrf-data.html"><a href="plotting-xrf-data.html"><i class="fa fa-check"></i><b>4.1</b> Plotting XRF Data</a></li>
<li class="chapter" data-level="4.2" data-path="plotting-images.html"><a href="plotting-images.html"><i class="fa fa-check"></i><b>4.2</b> Plotting Images</a></li>
<li class="chapter" data-level="4.3" data-path="combining-images-with-xrf-data.html"><a href="combining-images-with-xrf-data.html"><i class="fa fa-check"></i><b>4.3</b> Combining Images with XRF Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="transforming-data.html"><a href="transforming-data.html"><i class="fa fa-check"></i><b>5</b> Transforming Data</a><ul>
<li class="chapter" data-level="5.1" data-path="ratios-and-normalisation.html"><a href="ratios-and-normalisation.html"><i class="fa fa-check"></i><b>5.1</b> Ratios and Normalisation</a></li>
<li class="chapter" data-level="5.2" data-path="running-mean-and-other-window-functions.html"><a href="running-mean-and-other-window-functions.html"><i class="fa fa-check"></i><b>5.2</b> Running Mean and Other Window Functions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multivariate-methods.html"><a href="multivariate-methods.html"><i class="fa fa-check"></i><b>6</b> Multivariate Methods</a><ul>
<li class="chapter" data-level="6.1" data-path="preparing-data-for-multivariate-data-analysis.html"><a href="preparing-data-for-multivariate-data-analysis.html"><i class="fa fa-check"></i><b>6.1</b> Preparing Data for Multivariate Data Analysis</a></li>
<li class="chapter" data-level="6.2" data-path="principle-component-analysis.html"><a href="principle-component-analysis.html"><i class="fa fa-check"></i><b>6.2</b> Principle Component analysis</a></li>
<li class="chapter" data-level="6.3" data-path="unconstrained-cluster-analysis.html"><a href="unconstrained-cluster-analysis.html"><i class="fa fa-check"></i><b>6.3</b> Unconstrained Cluster Analysis</a></li>
<li class="chapter" data-level="6.4" data-path="constrained-cluster-analysis.html"><a href="constrained-cluster-analysis.html"><i class="fa fa-check"></i><b>6.4</b> Constrained Cluster Analysis</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="calibrating-data.html"><a href="calibrating-data.html"><i class="fa fa-check"></i><b>7</b> Calibrating Data</a><ul>
<li class="chapter" data-level="7.1" data-path="suitable-methods.html"><a href="suitable-methods.html"><i class="fa fa-check"></i><b>7.1</b> Suitable Methods</a></li>
<li class="chapter" data-level="7.2" data-path="preparing-data.html"><a href="preparing-data.html"><i class="fa fa-check"></i><b>7.2</b> Preparing Data</a></li>
<li class="chapter" data-level="7.3" data-path="linear-methods.html"><a href="linear-methods.html"><i class="fa fa-check"></i><b>7.3</b> Linear Methods</a></li>
<li class="chapter" data-level="7.4" data-path="log-ratio-methods.html"><a href="log-ratio-methods.html"><i class="fa fa-check"></i><b>7.4</b> Log-Ratio Methods</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exporting-data.html"><a href="exporting-data.html"><i class="fa fa-check"></i><b>8</b> Exporting Data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using Itrax Data in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="noisy-data" class="section level2">
<h2><span class="header-section-number">3.10</span> Noisy Data</h2>
<p>It is not always possible to do repeat scans for entire scanning projects, and as such it may be necessary to look at others ways of identifying problematic noisy data. Much of this can be done by good judgement on the part of the analyst, and will depend on the requirements of the projects. However, there are some analytical tools that can help. One method is to look at the autocorrelation of a time-series. We can use the auto-correlation factor (ACF) to explore this for our data.</p>
<p>We might begin with examples for just two elements, Ca and Pb. It is clear from these plots that whereas Ca has the expected pattern of autocorrelation, Pb has generally much lower and a more disordered pattern of autocorrelation.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="noisy-data.html#cb29-1"></a><span class="kw">library</span>(forecast)</span>
<span id="cb29-2"><a href="noisy-data.html#cb29-2"></a>egg<span class="op">::</span><span class="kw">ggarrange</span>(</span>
<span id="cb29-3"><a href="noisy-data.html#cb29-3"></a>  <span class="kw">ggAcf</span>(CD166_<span class="dv">19</span>_xrf<span class="op">$</span>Ca) <span class="op">+</span><span class="st"> </span></span>
<span id="cb29-4"><a href="noisy-data.html#cb29-4"></a><span class="st">    </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="ot">NA</span>,<span class="dv">1</span>)),</span>
<span id="cb29-5"><a href="noisy-data.html#cb29-5"></a>  <span class="kw">ggAcf</span>(CD166_<span class="dv">19</span>_xrf<span class="op">$</span>Pb) <span class="op">+</span><span class="st"> </span></span>
<span id="cb29-6"><a href="noisy-data.html#cb29-6"></a><span class="st">    </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="ot">NA</span>,<span class="dv">1</span>)),</span>
<span id="cb29-7"><a href="noisy-data.html#cb29-7"></a>  <span class="dt">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="itraxBook_files/figure-html/unnamed-chunk-7-1.png" width="672" />
Now we might move on to making calculations for the entirety of the data. In the example below we apply the <code>Acf()</code> function to each of the elements. We might then explore the data by sorting for an arbitrary lag, or by plotting the results together for inspection. In this case, the elements have been sorted by the autocorrelation value at a lag of 5. Although the visualisation is a bit messy with all the elements plotting over one another, it is clear that some elements exhibit very low autocorrelation (e.g. I, Pb, Sc, Ge, Cs, P) and could be possible candidates for exclusion.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="noisy-data.html#cb30-1"></a><span class="kw">apply</span>(CD166_<span class="dv">19</span>_xrf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">any_of</span>(elementsList)), <span class="dv">2</span>, <span class="dt">FUN =</span> <span class="cf">function</span>(x){<span class="kw">round</span>(<span class="kw">Acf</span>(x, <span class="dt">plot =</span> F)<span class="op">$</span>acf, <span class="dv">3</span>)}) <span class="op">%&gt;%</span></span>
<span id="cb30-2"><a href="noisy-data.html#cb30-2"></a><span class="st">  </span><span class="kw">as_tibble</span>(<span class="dt">rownames =</span> <span class="st">&quot;lag&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-3"><a href="noisy-data.html#cb30-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">!</span><span class="kw">c</span>(<span class="st">&quot;lag&quot;</span>), <span class="dt">names_to =</span> <span class="st">&quot;elements&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb30-4"><a href="noisy-data.html#cb30-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag =</span> <span class="kw">as.numeric</span>(lag),</span>
<span id="cb30-5"><a href="noisy-data.html#cb30-5"></a>         <span class="dt">elements =</span> <span class="kw">factor</span>(elements, <span class="dt">levels =</span> <span class="kw">filter</span>(., lag <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(elements))) <span class="op">%&gt;%</span></span>
<span id="cb30-6"><a href="noisy-data.html#cb30-6"></a><span class="st">  </span><span class="kw">group_by</span>(elements) <span class="op">%&gt;%</span></span>
<span id="cb30-7"><a href="noisy-data.html#cb30-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> lag, <span class="dt">y =</span> value, <span class="dt">col =</span> elements)) <span class="op">+</span></span>
<span id="cb30-8"><a href="noisy-data.html#cb30-8"></a><span class="st">  </span><span class="kw">geom_line</span>()</span></code></pre></div>
<p><img src="itraxBook_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>It is worth noting that this analysis has been performed on the entirety of the data, but there is no reason why the data could be problematic for some facies and acceptable for others. It may be necessary to perform some facies analysis and perform these analyses per facies.</p>
<p>Putting all the selection criteria together could look something like the example below.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="noisy-data.html#cb31-1"></a><span class="co"># identify acceptable variables</span></span>
<span id="cb31-2"><a href="noisy-data.html#cb31-2"></a><span class="kw">apply</span>(CD166_<span class="dv">19</span>_xrf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">any_of</span>(elementsList)), <span class="dv">2</span>, <span class="dt">FUN =</span> <span class="cf">function</span>(x){<span class="kw">round</span>(<span class="kw">Acf</span>(x, <span class="dt">plot =</span> F)<span class="op">$</span>acf, <span class="dv">3</span>)}) <span class="op">%&gt;%</span></span>
<span id="cb31-3"><a href="noisy-data.html#cb31-3"></a><span class="st">  </span><span class="kw">as_tibble</span>(<span class="dt">rownames =</span> <span class="st">&quot;lag&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb31-4"><a href="noisy-data.html#cb31-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">!</span><span class="kw">c</span>(<span class="st">&quot;lag&quot;</span>), <span class="dt">names_to =</span> <span class="st">&quot;elements&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb31-5"><a href="noisy-data.html#cb31-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lag =</span> <span class="kw">as.numeric</span>(lag),</span>
<span id="cb31-6"><a href="noisy-data.html#cb31-6"></a>         <span class="dt">elements =</span> <span class="kw">factor</span>(elements, <span class="dt">levels =</span> <span class="kw">filter</span>(., lag <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(value)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(elements))) <span class="op">%&gt;%</span></span>
<span id="cb31-7"><a href="noisy-data.html#cb31-7"></a><span class="st">  </span><span class="kw">group_by</span>(elements) <span class="op">%&gt;%</span></span>
<span id="cb31-8"><a href="noisy-data.html#cb31-8"></a><span class="st">  </span><span class="kw">filter</span>(lag <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span></span>
<span id="cb31-9"><a href="noisy-data.html#cb31-9"></a><span class="st">  </span><span class="kw">filter</span>(value <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.8</span>) <span class="op">%&gt;%</span></span>
<span id="cb31-10"><a href="noisy-data.html#cb31-10"></a><span class="st">  </span><span class="kw">pull</span>(elements) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-11"><a href="noisy-data.html#cb31-11"></a><span class="st">  </span><span class="kw">ordered</span>() -&gt;<span class="st"> </span>myElements</span>
<span id="cb31-12"><a href="noisy-data.html#cb31-12"></a></span>
<span id="cb31-13"><a href="noisy-data.html#cb31-13"></a><span class="co"># get acceptable observations</span></span>
<span id="cb31-14"><a href="noisy-data.html#cb31-14"></a>CD166_<span class="dv">19</span>_xrf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-15"><a href="noisy-data.html#cb31-15"></a><span class="st">  </span><span class="kw">filter</span>(qc <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb31-16"><a href="noisy-data.html#cb31-16"></a><span class="st">  </span></span>
<span id="cb31-17"><a href="noisy-data.html#cb31-17"></a><span class="st">  </span><span class="co"># pivot long</span></span>
<span id="cb31-18"><a href="noisy-data.html#cb31-18"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">any_of</span>(myElements), depth, label) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-19"><a href="noisy-data.html#cb31-19"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(<span class="op">!</span><span class="kw">c</span>(<span class="st">&quot;depth&quot;</span>, <span class="st">&quot;label&quot;</span>), <span class="dt">names_to =</span> <span class="st">&quot;elements&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;peakarea&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb31-20"><a href="noisy-data.html#cb31-20"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">elements =</span> <span class="kw">factor</span>(elements, <span class="dt">levels =</span> <span class="kw">c</span>(elementsList, <span class="st">&quot;coh/inc&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb31-21"><a href="noisy-data.html#cb31-21"></a><span class="st">  </span></span>
<span id="cb31-22"><a href="noisy-data.html#cb31-22"></a><span class="st">  </span><span class="co"># plot</span></span>
<span id="cb31-23"><a href="noisy-data.html#cb31-23"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> peakarea, <span class="dt">y =</span> depth)) <span class="op">+</span></span>
<span id="cb31-24"><a href="noisy-data.html#cb31-24"></a><span class="st">    </span>tidypaleo<span class="op">::</span><span class="kw">geom_lineh</span>(<span class="kw">aes</span>(<span class="dt">color =</span> label)) <span class="op">+</span></span>
<span id="cb31-25"><a href="noisy-data.html#cb31-25"></a><span class="st">    </span><span class="kw">scale_y_reverse</span>() <span class="op">+</span></span>
<span id="cb31-26"><a href="noisy-data.html#cb31-26"></a><span class="st">    </span><span class="kw">scale_x_continuous</span>(<span class="dt">n.breaks =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb31-27"><a href="noisy-data.html#cb31-27"></a><span class="st">    </span><span class="kw">facet_geochem_gridh</span>(<span class="kw">vars</span>(elements)) <span class="op">+</span></span>
<span id="cb31-28"><a href="noisy-data.html#cb31-28"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;peak area&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Depth [mm]&quot;</span>) <span class="op">+</span></span>
<span id="cb31-29"><a href="noisy-data.html#cb31-29"></a><span class="st">    </span>tidypaleo<span class="op">::</span><span class="kw">theme_paleo</span>() <span class="op">+</span></span>
<span id="cb31-30"><a href="noisy-data.html#cb31-30"></a><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="itraxBook_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="uncertainties.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reversing-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["itraxBook.pdf", "itraxBook.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
